# CentOS 7 Linux_4_5

## 4. 서버를 구축할 때 알아야 할 필수 개념과 명령어

### 4.5 네트워크 관련 설정과 명령어

#### 네트워크 관련 필수 개념

##### TCP/IP

* 프로토콜 중 가장 널리 사용되는 종류 중 하나
  * 프로토콜 : 컴퓨터끼리 네트워크상으로 의사소통을 하는 약속
* 통신의 전송/수신을 다루는 TCP(Transmission Control Protocol)와 데이터 통신을 다루는 IP(Internet Protocol)로 구성



##### 호스트 이름과 도메인 이름

* 호스트 이름 : 각각의 컴퓨터에 지정된 이름
* 도메인 이름(도메인 주소)
  * abc.co.kr 형식으로 표기
    * kr : 한국
    * co : 회사
    * abc : 단체/회사 이름
* ex) 호스트 이름이 this이고 도메인 이름이 abc.co.kr이라면 전체 이름은 this.abc.co.kr이고, 이를 FQDN(Fully Qualified Domain Name)이라고 부른다. 같은 도메인에서 this.abc.co.kr은 유일하다.



##### IP 주소

* 네트워크 카드(NIC) : 각 컴퓨터의 랜 카드
* 네트워크에 연결된 모든 컴퓨터는 고유한 IP 주소가 있다.
* 특정 컴퓨터의 IP주소를 알면, 그 컴퓨터가 전 세계 어디에 있든지 접속할 수 있다. (사설 IP 주소는 예외)
* 4바이트로 이루어지며, 각 자리는 0~255까지의 숫자가 올 수 있다.
* 모든 컴퓨터에서 자기 자신을 의미하는 IP 주소는 127.0.0.1이다.



##### 네트워크 주소

* 같은 네트워크에 속해 있는 공통 주소
* IP주소가 192.168.111.100이고 서브넷 마스크가 255.255.255.0 이라면 네트워크 주소는 앞 3자리인 192.168.111.0 이다.
* 192.168.xxx.ooo 의 주소 영역은 사설 네트워크의 주소다.
* 사설 네트워크는 외부와 분리된 내부의 별도 네트워크를 의미. 주로 공인 IP 주소가 부족할 때 많이 사용된다.



##### 브로드케스트 주소

* 내부 네트워크의 모든 컴퓨터가 수신하는 주소
* 현재 주소의 제일 끝자리를 255로 바꾼 주소다.(C 클래스의 경우)



##### 게이트웨이(Gateway)

* 내부 네트워크를 외부로 연결하는 컴퓨터 또는 장비

* 내부 네트워크에 있는 컴퓨터끼리 통신할 경우 외부로 나갈 필요가 없으므로 게이트웨이가 없어도 되지만, 인터넷을 사용하기 위해 외부에 접속하려면 반드시 게이트웨이의 IP 주소를 알아야 한다.

* 외부 네트워크로 나가는 통로

* 게이트웨이에는 내부로 향하는 네트워크 카드와 외부로 향하는 네트워크 카드가 있어야 한다. (네트워크 카드 두 개 장착)

* 실무에서 게이트웨이 주소는 제일 마지막 숫자를 254 또는 253 또는 1로 많이 사용

* 게이트웨이를 별도로 추가하는 명령어

  ```bash
  $ route add default gw 게이트웨이주소 dev 장치이름
  $ route add default gw 192.168.111.254 dev ens32
  ```

  

##### 넷마스크와 클래스

* 넷마스크 : 네트워크의 규모를 결정
* 사설 네트워크에서 C클래스를 사용한다면 넷마스크는 255.255.255.0으로 사용
* ex) 192.168.111.0 ~ 192.168.111.255까지 256개의 IP 주소 사용 가능
  * 192.168.111.0 : 네트워크 주소
  * 192.168.111.255 : 브로드캐스트 주소
  * 게이트웨이로 사용할 IP 주소
  * 총 253대의 컴퓨터를 네트워크 내부에서 연결 가능
* 만약 사설 네트워크에 253대가 넘는 컴퓨터를 설치하고자 한다면 서브넷 마스크를 255.255.0.0으로 변경 -> 총 65536개의 IP 주소 사용 가능



##### DNS 서버 주소

* 인터넷 사용 시 www.google.com과 같은 URL을 해당 컴퓨터의 IP 주소로 변환해주는 서버 컴퓨터
* DNS 서버(=네임 서버)의 주소를 사용하지 않거나, 잘못 입력되어 있으면 정상적으로 웹 사이트에 접속되지 않는다.
* 설정 파일은 `/etc/resolv.conf`이며, 내용 중 `nameserver DNS서버IP` 형식으로 설정되어 있음



#### 리눅스에서의 네트워크 장치 이름

* 랜 카드(NIC)가 리눅스에 장착되었을 때 CentOS 7은 자동으로 이 장치의 이름을 ens32 또는 ens33으로 인식한다.

* 이 랜 카드의 이름은 네트워크 정보를 파악하거나, 네트워크를 정지 또는 가동할 때 자주 사용한다.

  ```bash
  $ ifconfig ens32 또는 ens33	# 네트워크 설정 정보 출력
  $ ifup ens32 또는 ens33		# 네트워크 장치 가동
  $ ifdown ens32 또는 ens33		# 네트워크 장치 정지
  ```

  

#### 중요한 네트워크 관련 명령어

##### nmtui

* Network Manager Text User Interface의 약자로, 네트워크와 관련된 작업 대부분은 이 명령어를 기반으로 삼아 실행할 수 있다.
* 자동 IP 주소 또는 고정 IP 주소 사용 결정
* IP 주소, 서브넷 마스크, 게이트웨이 정보 입력
* DNS 정보 입력
* 네트워크 카드 드라이버 설정
* 네트워크 장치(ens32 또는 ens33)의 설정



##### systemctl start/stop/restart/status network

* 네트워크 설정을 변경한 후에 변경된 내용을 시스템에 적용시키는 명령어
* `nmtui` 명령어를 실행한 후 또는 직접 `ifcfg-ens32` 파일을 편집한 후에는, 꼭 `systemctl restart network` 명령어를 실행
* `status` 옵션 : 현재 작동 또는 정지 상태 표시



##### ifup 장치이름

* 해당 장치를 작동시켜주는 명령어
* 네트워크 장치가 장착되었으나 작동하지 않는다면 이 명령어로 네트워크 장치를 작동시킬 수 있다.
* 장치 이름에는 주로 ens32나 ens33이 사용된다.



##### ifdown 장치이름

* `ifup`과 반대로 네트워크 장치를 끄는 명령어



##### ifconfig 장치이름

* 해당 장치의 IP 주소와 관련된 정보를 출력해주는 명령어



##### nslookup

* DNS 서버의 작동을 테스트하는 명령어



##### ping IP주소 또는 URL

* 해당 컴퓨터가 네트워크상에서 응답하는지를 테스트하는 간편한 명령어
* 상대 컴퓨터가 아무런 이상 없이 작동되는지를 네트워크상에서 체크할 때 주로 사용



#### 네트워크 설정과 관련된 주요 파일

`nmtui` 명령어를 실행하고 나서 변경되는 관련 파일들

`nmtui` 명령어를 사용하지 않아도, 아래 4개 파일을 직접 편집하면 동일한 효과를 낼 수 있다.



##### /etc/sysconfig/network

* 네트워크의 기본 정보가 설정되어 있는 파일
* 네트워크 사용 여부가 써 있다.



##### /etc/sysconfig/network-scripts/ifcfg-ens32(또는 ifcfg-ens33)

* ens32 장치에 설정된 네트워크 정보가 모두 들어 있는 파일



##### /etc/resolv.conf

* DNS 서버의 정보와 호스트 이름이 들어 있는 파일



##### /etc/hosts

* 현 컴퓨터의 호스트 이름과 FQDN이 들어 있는 파일



#### 네트워크 보안을 위한 SELinux

* SELinux는 보안에 취약한 리눅스를 보호하기 위해 탄생
* 시스템에서 보안에 영향을 미치는 서비스, 권한 등을 제어할 수 있다.
* SELinux 환경에서는 해커가 어떤 경로로 시스템 침입에 성공하든, 침입한 경로의 애플리케이션 사용 이상의 권한을 얻지 못한다.
* SELinux의 사용 여부는 3가지 레벨을 지원
  * `강제(enforcing)`
    * 시스템 보안에 영향을 미치는 기능이 감지되면, 그 기능이 작동되지 않도록 시스템에서 막아준다.
  * `허용(permissive)`
    * 시스템 보안에 영향을 미치는 기능이 감지되면 허용은 하되 사용 내용이 로그에 남고, 화면상에도 출력된다.
  * `비활성(disabled)` 
    * SELinux를 사용하지 않는 것
    * 보안에 취약해진다.
* `/etc/sysconfig/selinux` : 설정 파일
* CentOS 7을 설치하면 기본적으로 강제로 설정되어있다.
* 보안을 강화하면 여러 가지 불편한 점이 발생할 수 있고, 반대로 보안을 약화하면 편리할 수는 있지만 위험이 따른다.

